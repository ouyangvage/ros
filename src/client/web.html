<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script type="text/javascript" src="http://static.robotwebtools.org/threejs/current/three.min.js"></script>
    <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script type="text/javascript" src="http://static.robotwebtools.org/ros3djs/current/ros3d.min.js"></script>
    <script type="text/javascript" type="text/javascript">
      /**
       * Setup all visualization elements when the page is loaded.
       */
      // Connect to ROS.
      var ros = new ROSLIB.Ros({
          url : 'ws://192.168.0.165:9090'
        });

      // add map service 
      var mapServerClient = new ROSLIB.Service({
          ros : ros,
          name : '/map_server',
          serviceType : 'service/MapServer'
        });

      //map create
      function map_create(){
        var request = new ROSLIB.ServiceRequest({
          map_controller: 'map_create'
        });

        mapServerClient.callService(request, function(result) {
          console.log('Result for service call on '
            + mapServerClient.name
            + ': '
            + result.sum);
        });
      }

      //map save
      function map_save(){
        var request = new ROSLIB.ServiceRequest({
          map_controller: 'map_save'
        });

        mapServerClient.callService(request, function(result) {
          console.log('Result for service call on '
            + mapServerClient.name
            + ': '
            + result.sum);
        });
      }

      //map load
      function map_load(){
        var request = new ROSLIB.ServiceRequest({
          map_controller: 'map_load'
        });

        mapServerClient.callService(request, function(result) {
          console.log('Result for service call on '
            + mapServerClient.name
            + ': '
            + result.sum);
        });
      }

      // add two service 
      function map_controller(){
        var addTwoIntsClient = new ROSLIB.Service({
          ros : ros,
          name : '/add_two_ints',
          serviceType : 'service/AddTwoInts'
        });

        var request = new ROSLIB.ServiceRequest({
          a : 2,
          b : 3
        });

        addTwoIntsClient.callService(request, function(result) {
          console.log('Result for service call on '
            + addTwoIntsClient.name
            + ': '
            + result.sum);
        });
      }

      function init() {
        // Create the main viewer.
        var viewer = new ROS3D.Viewer({
          divID : 'map',
          width : 400,
          height : 400,
          antialias : true
        });

        // add a grid
        viewer.addObject(new ROS3D.Grid());

        // Setup the map client.
        var gridClient = new ROS3D.OccupancyGridClient({
          ros : ros,
          rootObject : viewer.scene
        });

        // Setup a client to listen to TFs.
        var tfClient = new ROSLIB.TFClient({
          ros : ros,
          angularThres : 0.01,
          transThres : 0.01,
          rate : 10.0,
          fixedFrame : '/odom'
        });

        // Setup the URDF client.
        var urdfClient = new ROS3D.UrdfClient({
          ros : ros,
          tfClient : tfClient,
          path : 'http://resources.robotwebtools.org/',
          rootObject : viewer.scene,
          loader : ROS3D.COLLADA_LOADER_2
        });
      }

      function moveControll(){
        var cmdVel = new ROSLIB.Topic({
          ros : ros,
          name : '/cmd_vel',
          messageType : 'geometry_msgs/Twist'
        });

        var twist = new ROSLIB.Message({
          linear : {
            x : 0.0,
            y : 0.0,
            z : 0.0
          },
          angular : {
            x : 0.0,
            y : 0.0,
            z : 0.0
          }
        });

        document.onclick = function(){
          var obj = event.srcElement;
          switch(obj.id){
            case "left_up":
                twist.linear.x = 0.1;
                twist.angular.z = 0.1;
                break;
            case "up":
                twist.linear.x = 0.1;
              break;
            case "right_up":
              twist.linear.x = 0.1;
              twist.angular.z = -0.1;
              break;
            case "left":
              twist.angular.z = 0.1;
              break;
            case "stop":

              break;
            case "right":
                twist.angular.z = -0.1;
              break;
            case "left_down":
                twist.linear.x = -0.1;
                twist.angular.z = -0.1;
              break;
            case "down":
                twist.linear.x = -0.1;
                break;
            case "right_down":
                twist.linear.x = -0.1;
                twist.angular.z = 0.1;
              break;
            default:
              break;

          }
          cmdVel.publish(twist);
          document.getElementById("display").innerHTML = obj.id;
        }
      }
    </script>
  </head>

<body onload="init()">
  <h1>fdata</h1>
  <div>
    <input id="map_create" name="map_create" type="button" value="创建地图" onclick="map_create()"/>
    <input id="map_save" name="map_save" type="button" value="保存建图" onclick="map_save()"/>
    <input id="map_load" name="map_load" type="button" value="载入建图" onclick="map_load()"/>
    <input id="map_off" name="map_off" type="button" value="退出进程" onclick="map_off()"/> 
  </div>
  <div>
    <p id="display" name="display">
      我是内容显示区
    </p>
  </div>
  <div>
    <input id="get_point" name="get_point" type="button" value="获取目标点"/>
    <input id="move_to_point" name="move_to_point" type="button" value="移到目标点"/>
  </div>
  <div id="controll">
      <table id="controll" name="controll" onclick="moveControll()">
        <tr>
           <td>
             <input id="left_up" name="left_up" type="button" value="左前" /> 
           </td> 
           <td>
             <input id="up" name="up" type="button" value="向前" />
           </td>
           <td>
             <input id="right_up" name="right_up" type="button" value="右前"/>
           </td>
        </tr>
        <tr>
          <td>
            <input id="left" name="left" type="button" value="向左"/> 
          </td> 
          <td>
            <input id="stop" name="stop" type="button" value="停止" />
          </td>
          <td>
            <input id="right" name="right" type="button" value="向右"/>
          </td>
        </tr>
        <tr>
          <td>
            <input id="left_down" name="left_down" type="button" value="左后"/> 
          </td> 
          <td>
            <input id="down" name="down" type="button" value="向后"/>
          </td>
          <td>
            <input id="right_down" name="right_down" type="button" value="右后"/>
          </td>
        </tr>
      </table>
  </div>
  <div id="map"></div>
</body>
</html>
